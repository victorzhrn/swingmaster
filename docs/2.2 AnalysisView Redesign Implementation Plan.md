# Tennis App Analysis View - Redesign Implementation Plan

## Overview
Transform the Analysis View from a basic video player with metadata into a **visual coaching system** that delivers instant clarity on tennis technique issues.

---

## Phase 1: Critical Fixes (Day 1-2)
**Goal:** Fix breaking issues that harm usability

### 1.1 Fix Color Contrast Issues
- [x] Update insight card "Focus on improving" section
  - Replace `tennisYellow` with conditional color:
    ```swift
    colorScheme == .dark ? TennisColors.tennisYellow : TennisColors.clayOrange
    ```
- [ ] Audit all text elements for WCAG AA compliance (4.5:1 ratio)
- [ ] Test in bright sunlight simulation (max brightness + light mode)

### 1.2 Fix Timeline Scroll Bug
- [x] Remove ScrollView wrapper for videos < 2 minutes
- [x] Fix position calculation using actual content width:
  ```swift
  let xPos = (shot.time / duration) * (geo.size.width - 88) + 44
  ```
- [x] Add proper bounds checking for marker positions
- [ ] Test with various video durations (30s, 90s, 180s)

### 1.3 Video Container Polish
- [x] Add adaptive background behind video player
- [x] Increase corner radius from 12pt to 16pt
- [x] Add subtle shadow for light mode only:
  ```swift
  .shadow(color: colorScheme == .light ? .black.opacity(0.1) : .clear, radius: 10, y: 5)
  ```
- [x] Add 1pt border with 20% white opacity

**Acceptance Criteria:**
- All text readable in direct sunlight
- Timeline markers stay within bounds
- Video looks integrated, not floating

---

## Phase 2: Simplification (Day 3-4)
**Goal:** Remove clutter and improve focus

### 2.1 Clean Up Video Overlays
- [x] Remove persistent play/pause button overlay
- [x] Delete shot navigator ("Shot X of Y" + prev/next)
- [x] Rely on AVPlayerViewController native controls
- [x] Add minimal segment indicator (only during segment playback):
  ```swift
  if let segment = playingSegment {
      SegmentPill(segment: segment)
          .position(x: geo.size.width / 2, y: 20)
  }
  ```

### 2.2 Integrate Navigation into Timeline
- [x] Add prev/next buttons as 44pt targets on timeline edges
- [x] Style buttons with `chevron.left/right.circle.fill` SF Symbols
- [x] Use `TennisColors.courtGreen` for enabled state
- [x] Disable at boundaries with 0.4 opacity
- [x] Add haptic feedback on tap

### 2.3 Remove Redundant UI
- [x] Delete ShotChipsRow component entirely
- [x] Remove "Shot X of Y" label
- [x] Consolidate all navigation into timeline strip

**Acceptance Criteria:**
- Video view is clean with no overlapping controls
- All navigation happens through timeline
- One-thumb operation possible

---

## Phase 3: Design System Integration (Day 5-6)
**Goal:** Consistent use of established design patterns

### 3.1 Apply GlassContainer to Insight Card
- [x] Replace flat background with:
  ```swift
  GlassContainer(style: .medium, cornerRadius: 16) {
      // existing content
  }
  ```
- [x] Ensure proper padding (16pt from design system)
- [ ] Test glass effect with reduced transparency setting

### 3.2 Update Typography
- [x] Apply `TennisTypography.MetricStyle()` to scores
- [x] Use consistent font weights:
  - Headers: `.semibold`
  - Body: `.regular`
  - Emphasis: `.medium`
- [x] Ensure monospace for changing numbers

### 3.3 Color System Alignment
- [x] Create semantic color mapping:
  ```swift
  extension Color {
      static var shotExcellent: Color { TennisColors.aceGreen }
      static var shotGood: Color { TennisColors.courtGreen }
      static var shotNeedsWork: Color { 
          colorScheme == .dark ? TennisColors.tennisYellow : TennisColors.clayOrange 
      }
  }
  ```
- [x] Apply semantic colors throughout
- [x] Add color to timeline markers based on shot quality

**Acceptance Criteria:**
- Consistent glass morphism effects
- Typography follows system rules
- Colors adapt properly to dark/light mode

---

## Phase 4: Enhanced Timeline (Day 7-8)
**Goal:** Make timeline the primary control interface

### 4.1 Visual Enhancement
- [x] Add tennis court baseline metaphor:
  ```swift
  Rectangle()
      .fill(LinearGradient(
          colors: [.clear, TennisColors.courtGreen.opacity(0.1), .clear],
          startPoint: .top, endPoint: .bottom
      ))
  ```
- [x] Color-code markers by shot quality (green/yellow/orange)
- [x] Add pulse animation to selected marker
- [x] Show segment expansion ABOVE timeline (not replacing dot)

### 4.2 Interaction Improvements
- [x] Increase touch targets to 44pt minimum
- [x] Add tap-to-select on any marker
- [x] Auto-play segment when marker selected
- [x] Show segment duration as expanding bar during playback
- [x] Add progress fill animation during segment play

### 4.3 Accessibility
- [x] Add VoiceOver labels for all markers
- [x] Support adjustable actions (swipe up/down)
- [x] Announce segment transitions
- [x] Ensure 3:1 contrast for all states

**Acceptance Criteria:**
- Timeline is visually appealing and functional
- All interactions have haptic feedback
- Fully accessible with VoiceOver

---

## Phase 5: MVP Feature - Visual Coaching Overlay (Day 9-12)
**Goal:** Deliver the core value proposition

### 5.1 Create Overlay System
- [ ] Build `ContactPointOverlay` view component
- [ ] Integrate with VideoPlayerView using overlay modifier
- [ ] Sync overlay visibility with selected shot timing

### 5.2 Visual Markers
- [ ] Implement actual contact point (red circle, 60pt)
- [ ] Implement ideal contact point (green circle, 60pt)
- [ ] Add connecting line with arrow showing correction
- [ ] Animate markers on segment start (scale + fade in)
- [ ] Add distance measurement label

### 5.3 Motion Path Visualization
- [ ] Draw racquet path for last 0.5 seconds
- [ ] Use gradient stroke (fading trail effect)
- [ ] Highlight path deviation from ideal
- [ ] Add speed indicator at contact point

### 5.4 Coordinate System
- [ ] Map Vision framework coordinates to video space
- [ ] Handle portrait/landscape video correctly
- [ ] Account for video aspect ratio and scaling
- [ ] Test with various device sizes

**Acceptance Criteria:**
- Users see their mistake visually within 3 seconds
- Overlays are precisely positioned
- Animations are smooth at 60fps
- Works across all video orientations

---

## Phase 6: Polish & Optimization (Day 13-14)
**Goal:** Production-ready quality

### 6.1 Performance
- [ ] Profile with Instruments for 60fps
- [ ] Optimize overlay rendering (cache paths)
- [ ] Reduce memory usage for long videos
- [ ] Add loading states for overlay data

### 6.2 Edge Cases
- [ ] Handle videos with no detected shots
- [ ] Support very short clips (<10s)
- [ ] Gracefully degrade without pose data
- [ ] Test with corrupted/incomplete videos

### 6.3 Outdoor Usability
- [ ] Increase contrast for sunlight visibility
- [ ] Add optional high contrast mode
- [ ] Ensure minimum touch target sizes (48pt)
- [ ] Test with polarized sunglasses

### 6.4 Final Testing
- [ ] Test on iPhone SE (smallest)
- [ ] Test on iPhone 15 Pro Max (largest)
- [ ] Test on iPad (landscape + portrait)
- [ ] Test with VoiceOver enabled
- [ ] Test with Reduce Motion enabled
- [ ] Test in various lighting conditions

**Acceptance Criteria:**
- Consistent 60fps performance
- No crashes or memory leaks
- Usable in bright outdoor conditions
- Accessible to all users

---

## Success Metrics

### Quantitative
- Time to first insight: < 3 seconds
- Touch target success rate: > 95%
- Frame rate: Consistent 60fps
- Contrast ratio: â‰¥ 4.5:1 for all text

### Qualitative
- Users understand their mistake without reading text
- Interface feels premium and tennis-specific
- One-handed operation is comfortable
- Works reliably on tennis court

---

## Risk Mitigation

### Technical Risks
- **Video overlay sync issues**
  - Mitigation: Use AVPlayer time observer with 0.05s intervals
  - Fallback: Show overlay as static image at key moment

- **Performance on older devices**
  - Mitigation: Conditionally disable animations on iPhone 11 and older
  - Fallback: Reduce overlay complexity on low-end devices

### UX Risks
- **Too much visual information**
  - Mitigation: User testing with progressive disclosure
  - Fallback: Settings to toggle overlay features

- **Bright sunlight illegibility**
  - Mitigation: High contrast mode toggle
  - Fallback: Audio cues for key moments

---

## Dependencies

### Required Before Starting
- [ ] Pose data coordinates from Vision framework
- [ ] Shot detection with accurate timestamps
- [ ] Ideal vs actual contact point calculations

### Design Assets Needed
- [ ] SF Symbol selections for shot types
- [ ] Loading state animations
- [ ] Empty state illustrations

### Testing Resources
- [ ] Sample videos (various lighting/angles)
- [ ] Test devices (iPhone SE to iPad)
- [ ] Beta testers who play tennis

---

## Post-Launch Iterations

### V1.1 (2 weeks post-launch)
- Multi-shot comparison view
- Slow-motion playback for key moments
- Export frames with overlays

### V1.2 (1 month post-launch)
- Historical progress tracking
- Personalized coaching tips
- Share clips with coach

### V2.0 (3 months post-launch)
- Real-time coaching during recording
- 3D visualization of body mechanics
- AI-powered form corrections